
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>iTerm2 Python API Tutorial &#8212; iTerm2 Python API 0.26 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="The “window” module" href="window.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="iterm2-python-api-tutorial">
<h1>iTerm2 Python API Tutorial<a class="headerlink" href="#iterm2-python-api-tutorial" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
</div>
<p>The iTerm2 Python API is a replacement for the Applescript API that preceded
it. It offers a more powerful set of APIs that give the script writer a great
deal of control.</p>
<p>Scripts generally take one of two forms:</p>
<blockquote>
<div><ul class="simple">
<li>“Simple” scripts that perform a series of actions, such as creating windows,
* and then terminate.</li>
<li>“Long-running daemons” that stay running indefintely while observing
* notifications.</li>
</ul>
</div></blockquote>
<div class="section" id="creating-a-new-script">
<h2>Creating a New Script<a class="headerlink" href="#creating-a-new-script" title="Permalink to this headline">¶</a></h2>
<p>iTerm2 provides a convenient user interface for creating a new script. Select
<em>Scripts &gt; New Python Script</em>. You’ll then be prompted to decide if you want a
“basic” script or one with a “full environment”. Don’t worry about the
difference yet. Pick basic, since the code in this tutorial does not depend on
any Python modules besides the built-in ones.</p>
<p>Next, you’ll be asked if you want to write a simple script or a long-running
daemon. Select simple. Then give your script a name, and it will be opened in
your editor.</p>
<p>The script will be prepopulated with a working example, shown below.</p>
</div>
<div class="section" id="working-example">
<h2>Working Example<a class="headerlink" href="#working-example" title="Permalink to this headline">¶</a></h2>
<p>To begin, let’s look at a basic script that creates a window.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>

<span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">import</span> <span class="nn">iterm2</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="n">argv</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">await</span> <span class="n">iterm2</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">get_app</span><span class="p">(</span><span class="n">connection</span><span class="p">)</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">await</span> <span class="n">a</span><span class="o">.</span><span class="n">get_key_window</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">w</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">await</span> <span class="n">w</span><span class="o">.</span><span class="n">create_tab</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;No current window&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">iterm2</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">Connection</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
</pre></div>
</div>
<p>There’s a lot going on here. Let’s take it part by part.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
</pre></div>
</div>
<p>This is standard Python boilerplate so that the script can be run from the command line.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">import</span> <span class="nn">iterm2</span>
<span class="kn">import</span> <span class="nn">sys</span>
</pre></div>
</div>
<p>The first import is <cite>asyncio</cite>. The iTerm2 Python API is based on asyncio. If
you’re not familiar with it, you should take some time to
<a class="reference external" href="https://docs.python.org/3/library/asyncio.html">learn about it</a>.</p>
<p>The next import is <cite>iterm2</cite>. That’s a Python module (available on PyPI) that
provides a nice interface to communicate with iTerm2. The underlying
implementation uses Google protobuf and websockets, but that is (mostly)
abstracted away by this module.</p>
<p>Finally, <cite>sys</cite> is imported so that the script can parse command-line arguments.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="n">argv</span><span class="p">):</span>
</pre></div>
</div>
<p>Your code goes inside <cite>main</cite>. The first argument is a <cite>connection</cite> that holds
the link to a running iTerm2 process. If <cite>main</cite> gets called, then the
connection is established. If the connection terminates (e.g., if you quit
iTerm2) then any attempt to use it will raise an exception and terminate your
script.</p>
<p>The second argument, <cite>argv</cite>, gives the command-line arguments passed to the
script. When you launch a script from iTerm2, it does not receive any
arguments. But you can also run this script manually and pass it command-line
arguments.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">await</span> <span class="n">iterm2</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">get_app</span><span class="p">(</span><span class="n">connection</span><span class="p">)</span>
</pre></div>
</div>
<p>The purpose of this line is to get a reference to the <a class="reference internal" href="app.html#iterm2.app.App" title="iterm2.app.App"><code class="xref py py-class docutils literal notranslate"><span class="pre">iterm2.app.App</span></code></a> object, which is
useful for most things you’ll want to do in a simple script. It is a singleton
that provides access to iTerm2’s global state, such as its windows.</p>
<p>Note the use of <cite>await</cite>. Any function that’s defined as <cite>async</cite>, which most
functions in the iTerm2 API are, must be called with <cite>await</cite>. It means it might
not return immediately. In this case, it makes an RPC call to iTerm2 to get its
state (such as the list of windows). The returned value is an
<a class="reference internal" href="app.html#iterm2.app.App" title="iterm2.app.App"><code class="xref py py-class docutils literal notranslate"><span class="pre">iterm2.app.App</span></code></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">w</span> <span class="o">=</span> <span class="n">await</span> <span class="n">a</span><span class="o">.</span><span class="n">get_key_window</span><span class="p">()</span>
</pre></div>
</div>
<p>The fetches the “key window” from the app. The key window is the window that
receives keyboard input. If iTerm2 is not active or has no windows, then no
window will be key and <cite>get_key_window</cite> returns None.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">w</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
    <span class="n">await</span> <span class="n">w</span><span class="o">.</span><span class="n">create_tab</span><span class="p">()</span>
</pre></div>
</div>
<p>If there is a key window, add a tab to it. The new tab uses the default
profile.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">else</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;No current window&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This prints a diagnostic message. You can view these messages in the Script
Console. Select <em>Scripts &gt; Script Console</em> in iTerm2 to view the output of
your scripts. If something’s not working right, you can usually find the
problem in the Script Console. You can also use it to terminate a misbehaving
script.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">iterm2</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">Connection</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
</pre></div>
</div>
<p>The <cite>if</cite> statement is a bit of standard Python boilerplate; you can ignore it
as its condition will always be True.</p>
<p>The next line establishes a websocket connection to iTerm2 and then runs your
<cite>main</cite> function, passing it <cite>sys.argv</cite> which holds the command-line arguments.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">iTerm2 Python API Tutorial</a><ul>
<li><a class="reference internal" href="#creating-a-new-script">Creating a New Script</a></li>
<li><a class="reference internal" href="#working-example">Working Example</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="window.html" title="previous chapter">The “window” module</a></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/tutorial.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, George Nachman.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="_sources/tutorial.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>